\doxysection{src/broker.c File Reference}
\hypertarget{broker_8c}{}\label{broker_8c}\index{src/broker.c@{src/broker.c}}


Implements the message broker for the publish-\/subscribe architecture.  


{\ttfamily \#include $<$string.\+h$>$}\newline
{\ttfamily \#include $<$stdbool.\+h$>$}\newline
{\ttfamily \#include "{}broker.\+h"{}}\newline
\doxysubsubsection*{Macros}
\begin{DoxyCompactItemize}
\item 
\#define \mbox{\hyperlink{broker_8c_a623ec78b7909090dbedac4af1d52abb4}{MAX\+\_\+\+QUEUE\+\_\+\+SIZE}}~64
\item 
\#define \mbox{\hyperlink{broker_8c_a25b9f6533efd7b3caf52d7f873352234}{TOPIC\+\_\+\+MASK}}~0x3\+FFEFFF
\end{DoxyCompactItemize}
\doxysubsubsection*{Functions}
\begin{DoxyCompactItemize}
\item 
\mbox{\hyperlink{active__object_8h_acf503bbd3e9a97c6f2753e916c71b076}{broker\+\_\+t}} \texorpdfstring{$\ast$}{*} \mbox{\hyperlink{broker_8c_ae84ea3f0fc46a3a0c35b9b673f35b966}{broker\+\_\+ctor}} (void)
\begin{DoxyCompactList}\small\item\em Initializes a Broker instance. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{broker_8c_ae7913925f99c2b3d7e48ea141543d6a4}{broker\+\_\+subscribe}} (\mbox{\hyperlink{active__object_8h_acf503bbd3e9a97c6f2753e916c71b076}{broker\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{structbroker}{broker}}, \mbox{\hyperlink{structtopic__config__t}{topic\+\_\+config\+\_\+t}} \texorpdfstring{$\ast$}{*}configs, uint16\+\_\+t length, \mbox{\hyperlink{active__object_8h_ae666e05601080a7e76aa12feef53d049}{base\+\_\+obj\+\_\+t}} \texorpdfstring{$\ast$}{*}subscriber)
\begin{DoxyCompactList}\small\item\em Subscribes an Active\+Object to one or more topics. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{broker_8c_ac6c5918a794e9c28bda12384d078869b}{broker\+\_\+unsubscribe}} (\mbox{\hyperlink{active__object_8h_acf503bbd3e9a97c6f2753e916c71b076}{broker\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{structbroker}{broker}}, \mbox{\hyperlink{structtopic__config__t}{topic\+\_\+config\+\_\+t}} \texorpdfstring{$\ast$}{*}configs, uint16\+\_\+t length, \mbox{\hyperlink{active__object_8h_ae666e05601080a7e76aa12feef53d049}{base\+\_\+obj\+\_\+t}} \texorpdfstring{$\ast$}{*}subscriber)
\begin{DoxyCompactList}\small\item\em Unsubscribes an Active\+Object from multiple topics. \end{DoxyCompactList}\item 
int \mbox{\hyperlink{broker_8c_aca5a06178a10e0080861f092e9cc5cb7}{broker\+\_\+publish}} (\mbox{\hyperlink{active__object_8h_acf503bbd3e9a97c6f2753e916c71b076}{broker\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{structbroker}{broker}}, uint32\+\_\+t topic, const \mbox{\hyperlink{structmessage__frame__t}{message\+\_\+frame\+\_\+t}} frame)
\begin{DoxyCompactList}\small\item\em Publishes a message to a topic. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{broker_8c_a66cb0d857015d19942dd14dffa533965}{broker\+\_\+post}} (\mbox{\hyperlink{active__object_8h_acf503bbd3e9a97c6f2753e916c71b076}{broker\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{structbroker}{broker}}, \mbox{\hyperlink{structmessage__frame__t}{message\+\_\+frame\+\_\+t}} frame, int primary)
\begin{DoxyCompactList}\small\item\em Posts a message to the broker queue. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{broker_8c_aedfa6e518ee5f8e36d1e32769541f3d3}{broker\+\_\+post\+\_\+simulink}} (uint8\+\_\+t \texorpdfstring{$\ast$}{*}data, uint8\+\_\+t length)
\begin{DoxyCompactList}\small\item\em Posts a message from Simulink to the broker queue. \end{DoxyCompactList}\item 
void \mbox{\hyperlink{broker_8c_afa68ba3545281783006a71f7aa37e513}{broker\+\_\+post\+\_\+\+ISR}} (\mbox{\hyperlink{active__object_8h_acf503bbd3e9a97c6f2753e916c71b076}{broker\+\_\+t}} \texorpdfstring{$\ast$}{*}\mbox{\hyperlink{structbroker}{broker}}, \mbox{\hyperlink{structmessage__frame__t}{message\+\_\+frame\+\_\+t}} frame, int primary)
\begin{DoxyCompactList}\small\item\em Posts a message from an ISR (Interrupt Service Routine). \end{DoxyCompactList}\item 
void \mbox{\hyperlink{broker_8c_a5c8d0434b474aaa2be629a29ab7d895f}{broker\+\_\+set\+\_\+filter}} (uint32\+\_\+t msg\+Id, uint32\+\_\+t mask, uint8\+\_\+t filter\+Type)
\begin{DoxyCompactList}\small\item\em Configures a message filter for incoming CAN messages. \end{DoxyCompactList}\end{DoxyCompactItemize}


\doxysubsection{Detailed Description}
Implements the message broker for the publish-\/subscribe architecture. 

This file provides the broker implementation, which enables message-\/based communication between active objects. It supports topic-\/based subscriptions, message filtering, and queuing for both primary and secondary tasks.

The broker ensures reliable message delivery across multiple threads, supporting both Windows (with threads and condition variables) and Free\+RTOS (with task queues and semaphores).

\begin{DoxyAuthor}{Author}
Nathan Ikolo 
\end{DoxyAuthor}
\begin{DoxyDate}{Date}
February 6, 2025 
\end{DoxyDate}


Definition in file \mbox{\hyperlink{broker_8c_source}{broker.\+c}}.



\doxysubsection{Macro Definition Documentation}
\Hypertarget{broker_8c_a623ec78b7909090dbedac4af1d52abb4}\index{broker.c@{broker.c}!MAX\_QUEUE\_SIZE@{MAX\_QUEUE\_SIZE}}
\index{MAX\_QUEUE\_SIZE@{MAX\_QUEUE\_SIZE}!broker.c@{broker.c}}
\doxysubsubsection{\texorpdfstring{MAX\_QUEUE\_SIZE}{MAX\_QUEUE\_SIZE}}
{\footnotesize\ttfamily \label{broker_8c_a623ec78b7909090dbedac4af1d52abb4} 
\#define MAX\+\_\+\+QUEUE\+\_\+\+SIZE~64}

Maximum size of the broker queue. 

Definition at line \mbox{\hyperlink{broker_8c_source_l00025}{25}} of file \mbox{\hyperlink{broker_8c_source}{broker.\+c}}.

\Hypertarget{broker_8c_a25b9f6533efd7b3caf52d7f873352234}\index{broker.c@{broker.c}!TOPIC\_MASK@{TOPIC\_MASK}}
\index{TOPIC\_MASK@{TOPIC\_MASK}!broker.c@{broker.c}}
\doxysubsubsection{\texorpdfstring{TOPIC\_MASK}{TOPIC\_MASK}}
{\footnotesize\ttfamily \label{broker_8c_a25b9f6533efd7b3caf52d7f873352234} 
\#define TOPIC\+\_\+\+MASK~0x3\+FFEFFF}

Mask used to extract topic ID. 

Definition at line \mbox{\hyperlink{broker_8c_source_l00026}{26}} of file \mbox{\hyperlink{broker_8c_source}{broker.\+c}}.



\doxysubsection{Function Documentation}
\Hypertarget{broker_8c_ae84ea3f0fc46a3a0c35b9b673f35b966}\index{broker.c@{broker.c}!broker\_ctor@{broker\_ctor}}
\index{broker\_ctor@{broker\_ctor}!broker.c@{broker.c}}
\doxysubsubsection{\texorpdfstring{broker\_ctor()}{broker\_ctor()}}
{\footnotesize\ttfamily \label{broker_8c_ae84ea3f0fc46a3a0c35b9b673f35b966} 
\mbox{\hyperlink{active__object_8h_acf503bbd3e9a97c6f2753e916c71b076}{broker\+\_\+t}} \texorpdfstring{$\ast$}{*} broker\+\_\+ctor (\begin{DoxyParamCaption}\item[{void}]{}{}\end{DoxyParamCaption})}



Initializes a Broker instance. 

Allocates memory and initializes the message queues and subscription lists.

\begin{DoxyReturn}{Returns}
Pointer to the initialized broker instance. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{broker_8c_source_l00188}{188}} of file \mbox{\hyperlink{broker_8c_source}{broker.\+c}}.

\Hypertarget{broker_8c_a66cb0d857015d19942dd14dffa533965}\index{broker.c@{broker.c}!broker\_post@{broker\_post}}
\index{broker\_post@{broker\_post}!broker.c@{broker.c}}
\doxysubsubsection{\texorpdfstring{broker\_post()}{broker\_post()}}
{\footnotesize\ttfamily \label{broker_8c_a66cb0d857015d19942dd14dffa533965} 
void broker\+\_\+post (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{active__object_8h_acf503bbd3e9a97c6f2753e916c71b076}{broker\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{broker}{, }\item[{\mbox{\hyperlink{structmessage__frame__t}{message\+\_\+frame\+\_\+t}}}]{frame}{, }\item[{int}]{primary}{}\end{DoxyParamCaption})}



Posts a message to the broker queue. 

The message is placed in either the {\bfseries{primary or secondary queue}}, based on the {\ttfamily primary} parameter.


\begin{DoxyParams}{Parameters}
{\em broker} & Pointer to the broker instance. \\
\hline
{\em frame} & Message frame to be queued. \\
\hline
{\em primary} & Specifies the queue to use (PRIMARY\+\_\+\+QUEUE or SECONDARY\+\_\+\+QUEUE). \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{broker_8c_source_l00359}{359}} of file \mbox{\hyperlink{broker_8c_source}{broker.\+c}}.

\Hypertarget{broker_8c_afa68ba3545281783006a71f7aa37e513}\index{broker.c@{broker.c}!broker\_post\_ISR@{broker\_post\_ISR}}
\index{broker\_post\_ISR@{broker\_post\_ISR}!broker.c@{broker.c}}
\doxysubsubsection{\texorpdfstring{broker\_post\_ISR()}{broker\_post\_ISR()}}
{\footnotesize\ttfamily \label{broker_8c_afa68ba3545281783006a71f7aa37e513} 
void broker\+\_\+post\+\_\+\+ISR (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{active__object_8h_acf503bbd3e9a97c6f2753e916c71b076}{broker\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{broker}{, }\item[{\mbox{\hyperlink{structmessage__frame__t}{message\+\_\+frame\+\_\+t}}}]{frame}{, }\item[{int}]{primary}{}\end{DoxyParamCaption})}



Posts a message from an ISR (Interrupt Service Routine). 

Ensures real-\/time event dispatching without blocking execution.


\begin{DoxyParams}{Parameters}
{\em broker} & Pointer to the broker instance. \\
\hline
{\em frame} & Message frame to be queued. \\
\hline
{\em primary} & Determines which queue to use (PRIMARY\+\_\+\+QUEUE or SECONDARY\+\_\+\+QUEUE). \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{broker_8c_source_l00378}{378}} of file \mbox{\hyperlink{broker_8c_source}{broker.\+c}}.

\Hypertarget{broker_8c_aedfa6e518ee5f8e36d1e32769541f3d3}\index{broker.c@{broker.c}!broker\_post\_simulink@{broker\_post\_simulink}}
\index{broker\_post\_simulink@{broker\_post\_simulink}!broker.c@{broker.c}}
\doxysubsubsection{\texorpdfstring{broker\_post\_simulink()}{broker\_post\_simulink()}}
{\footnotesize\ttfamily \label{broker_8c_aedfa6e518ee5f8e36d1e32769541f3d3} 
void broker\+\_\+post\+\_\+simulink (\begin{DoxyParamCaption}\item[{uint8\+\_\+t \texorpdfstring{$\ast$}{*}}]{data}{, }\item[{uint8\+\_\+t}]{length}{}\end{DoxyParamCaption})}



Posts a message from Simulink to the broker queue. 

Used for interfacing with Simulink-\/generated models.


\begin{DoxyParams}{Parameters}
{\em data} & Pointer to the message data. \\
\hline
{\em length} & Length of the message data. \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{broker_8c_source_l00367}{367}} of file \mbox{\hyperlink{broker_8c_source}{broker.\+c}}.

\Hypertarget{broker_8c_aca5a06178a10e0080861f092e9cc5cb7}\index{broker.c@{broker.c}!broker\_publish@{broker\_publish}}
\index{broker\_publish@{broker\_publish}!broker.c@{broker.c}}
\doxysubsubsection{\texorpdfstring{broker\_publish()}{broker\_publish()}}
{\footnotesize\ttfamily \label{broker_8c_aca5a06178a10e0080861f092e9cc5cb7} 
int broker\+\_\+publish (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{active__object_8h_acf503bbd3e9a97c6f2753e916c71b076}{broker\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{broker}{, }\item[{uint32\+\_\+t}]{topic}{, }\item[{const \mbox{\hyperlink{structmessage__frame__t}{message\+\_\+frame\+\_\+t}}}]{frame}{}\end{DoxyParamCaption})}



Publishes a message to a topic. 

The message is delivered to all subscribers of the specified topic.


\begin{DoxyParams}{Parameters}
{\em broker} & Pointer to the broker instance. \\
\hline
{\em topic} & Topic ID to publish to. \\
\hline
{\em frame} & Message frame containing the data. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
1 if successful, 0 otherwise. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{broker_8c_source_l00304}{304}} of file \mbox{\hyperlink{broker_8c_source}{broker.\+c}}.

\Hypertarget{broker_8c_a5c8d0434b474aaa2be629a29ab7d895f}\index{broker.c@{broker.c}!broker\_set\_filter@{broker\_set\_filter}}
\index{broker\_set\_filter@{broker\_set\_filter}!broker.c@{broker.c}}
\doxysubsubsection{\texorpdfstring{broker\_set\_filter()}{broker\_set\_filter()}}
{\footnotesize\ttfamily \label{broker_8c_a5c8d0434b474aaa2be629a29ab7d895f} 
void broker\+\_\+set\+\_\+filter (\begin{DoxyParamCaption}\item[{uint32\+\_\+t}]{msg\+Id}{, }\item[{uint32\+\_\+t}]{mask}{, }\item[{uint8\+\_\+t}]{filter\+\_\+type}{}\end{DoxyParamCaption})}



Configures a message filter for incoming CAN messages. 

Used to limit which messages are processed based on ID and mask.


\begin{DoxyParams}{Parameters}
{\em msg\+Id} & The message ID to filter. \\
\hline
{\em mask} & Bitmask for filtering. \\
\hline
{\em filter\+\_\+type} & Type of filtering (MASK, RANGE, etc.). \\
\hline
\end{DoxyParams}


Definition at line \mbox{\hyperlink{broker_8c_source_l00386}{386}} of file \mbox{\hyperlink{broker_8c_source}{broker.\+c}}.

\Hypertarget{broker_8c_ae7913925f99c2b3d7e48ea141543d6a4}\index{broker.c@{broker.c}!broker\_subscribe@{broker\_subscribe}}
\index{broker\_subscribe@{broker\_subscribe}!broker.c@{broker.c}}
\doxysubsubsection{\texorpdfstring{broker\_subscribe()}{broker\_subscribe()}}
{\footnotesize\ttfamily \label{broker_8c_ae7913925f99c2b3d7e48ea141543d6a4} 
int broker\+\_\+subscribe (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{active__object_8h_acf503bbd3e9a97c6f2753e916c71b076}{broker\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{broker}{, }\item[{\mbox{\hyperlink{structtopic__config__t}{topic\+\_\+config\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{configs}{, }\item[{uint16\+\_\+t}]{length}{, }\item[{\mbox{\hyperlink{active__object_8h_ae666e05601080a7e76aa12feef53d049}{base\+\_\+obj\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{subscriber}{}\end{DoxyParamCaption})}



Subscribes an Active\+Object to one or more topics. 


\begin{DoxyParams}{Parameters}
{\em broker} & Pointer to the broker instance. \\
\hline
{\em configs} & Pointer to topic configurations. \\
\hline
{\em length} & Number of topics in {\ttfamily configs}. \\
\hline
{\em subscriber} & The Active\+Object subscribing to topics. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
1 if subscription was successful, 0 otherwise. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{broker_8c_source_l00214}{214}} of file \mbox{\hyperlink{broker_8c_source}{broker.\+c}}.

\Hypertarget{broker_8c_ac6c5918a794e9c28bda12384d078869b}\index{broker.c@{broker.c}!broker\_unsubscribe@{broker\_unsubscribe}}
\index{broker\_unsubscribe@{broker\_unsubscribe}!broker.c@{broker.c}}
\doxysubsubsection{\texorpdfstring{broker\_unsubscribe()}{broker\_unsubscribe()}}
{\footnotesize\ttfamily \label{broker_8c_ac6c5918a794e9c28bda12384d078869b} 
int broker\+\_\+unsubscribe (\begin{DoxyParamCaption}\item[{\mbox{\hyperlink{active__object_8h_acf503bbd3e9a97c6f2753e916c71b076}{broker\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{broker}{, }\item[{\mbox{\hyperlink{structtopic__config__t}{topic\+\_\+config\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{configs}{, }\item[{uint16\+\_\+t}]{length}{, }\item[{\mbox{\hyperlink{active__object_8h_ae666e05601080a7e76aa12feef53d049}{base\+\_\+obj\+\_\+t}} \texorpdfstring{$\ast$}{*}}]{subscriber}{}\end{DoxyParamCaption})}



Unsubscribes an Active\+Object from multiple topics. 


\begin{DoxyParams}{Parameters}
{\em broker} & Pointer to the Broker instance. \\
\hline
{\em configs} & Pointer to an array of topic configurations. \\
\hline
{\em length} & Number of topics in {\ttfamily configs}. \\
\hline
{\em subscriber} & The Active\+Object that wants to unsubscribe. \\
\hline
\end{DoxyParams}
\begin{DoxyReturn}{Returns}
Number of successfully unsubscribed topics. 
\end{DoxyReturn}


Definition at line \mbox{\hyperlink{broker_8c_source_l00266}{266}} of file \mbox{\hyperlink{broker_8c_source}{broker.\+c}}.

