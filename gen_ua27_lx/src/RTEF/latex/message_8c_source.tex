\doxysection{message.\+c}
\hypertarget{message_8c_source}{}\label{message_8c_source}\index{src/message.c@{src/message.c}}
\mbox{\hyperlink{message_8c}{Go to the documentation of this file.}}
\begin{DoxyCode}{0}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00001}00001\ }
\DoxyCodeLine{\Hypertarget{message_8c_source_l00015}00015\ }
\DoxyCodeLine{\Hypertarget{message_8c_source_l00016}00016\ \textcolor{preprocessor}{\#ifdef\ \_\_cplusplus}}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00017}00017\ \textcolor{keyword}{extern}\ \textcolor{stringliteral}{"{}C"{}}\ \{}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00018}00018\ \textcolor{preprocessor}{\#endif}}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00019}00019\ }
\DoxyCodeLine{\Hypertarget{message_8c_source_l00020}00020\ \textcolor{preprocessor}{\#include\ <string.h>}}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00021}00021\ \textcolor{preprocessor}{\#include\ "{}\mbox{\hyperlink{message_8h}{message.h}}"{}}}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00022}00022\ }
\DoxyCodeLine{\Hypertarget{message_8c_source_l00028}\mbox{\hyperlink{message_8h_a52fc8532bc7516189314f3df105ef056}{00028}}\ uint32\_t\ \mbox{\hyperlink{message_8c_a52fc8532bc7516189314f3df105ef056}{message\_encode\_can\_id}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structmessage__frame__t}{message\_frame\_t}}*\ frame)\ \{}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00029}00029\ \ \ \ \ uint32\_t\ canId\ =\ 0;}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00030}00030\ }
\DoxyCodeLine{\Hypertarget{message_8c_source_l00031}00031\ \ \ \ \ canId\ |=\ ((uint32\_t)(frame-\/>\mbox{\hyperlink{structmessage__frame__t_a0ad043071ccc7a261d79a759dc9c6f0c}{priority}})\ \&\ 0x07)\ <<\ 26;}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00032}00032\ \ \ \ \ canId\ |=\ ((uint32\_t)(frame-\/>\mbox{\hyperlink{structmessage__frame__t_a48af506af0422523e9a1082d6092bbd6}{destAddress}})\ \&\ 0xFF)\ <<\ 18;}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00033}00033\ \ \ \ \ canId\ |=\ ((uint32\_t)(frame-\/>\mbox{\hyperlink{structmessage__frame__t_a8a645ccac6739903ec0a78f1c65bfd16}{srcAddress}})\ \&\ 0xFF)\ <<\ 10;}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00034}00034\ \ \ \ \ canId\ |=\ ((uint32\_t)(frame-\/>\mbox{\hyperlink{structmessage__frame__t_a5e0eac93675392e0ae2ab36d85449caf}{mode}})\ \&\ 0x01)\ <<\ 9;}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00035}00035\ \ \ \ \ canId\ |=\ ((uint32\_t)(frame-\/>\mbox{\hyperlink{structmessage__frame__t_adfd13b91d35801a9f13c730d0ab9d3b5}{topicOrServiceId}})\ \&\ 0x1F)\ <<\ 4;}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00036}00036\ \ \ \ \ canId\ |=\ ((uint32\_t)(frame-\/>\mbox{\hyperlink{structmessage__frame__t_a5f2145d3e176cdfdc684f39c7fbad8bb}{type}})\ \&\ 0x0F);}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00037}00037\ }
\DoxyCodeLine{\Hypertarget{message_8c_source_l00038}00038\ \ \ \ \ \textcolor{keywordflow}{return}\ canId;}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00039}00039\ \}}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00040}00040\ }
\DoxyCodeLine{\Hypertarget{message_8c_source_l00046}\mbox{\hyperlink{message_8h_aa11419f7bcfe097cf3f14e4fb4b708da}{00046}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{message_8c_aa11419f7bcfe097cf3f14e4fb4b708da}{message\_decode\_can\_id}}(uint32\_t\ canId,\ \mbox{\hyperlink{structmessage__frame__t}{message\_frame\_t}}*\ frame)\ \{}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00047}00047\ \ \ \ \ frame-\/>\mbox{\hyperlink{structmessage__frame__t_a0ad043071ccc7a261d79a759dc9c6f0c}{priority}}\ =\ (canId\ >>\ 26)\ \&\ 0x07;}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00048}00048\ \ \ \ \ frame-\/>\mbox{\hyperlink{structmessage__frame__t_a48af506af0422523e9a1082d6092bbd6}{destAddress}}\ =\ (canId\ >>\ 18)\ \&\ 0xFF;}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00049}00049\ \ \ \ \ frame-\/>\mbox{\hyperlink{structmessage__frame__t_a8a645ccac6739903ec0a78f1c65bfd16}{srcAddress}}\ =\ (canId\ >>\ 10)\ \&\ 0xFF;}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00050}00050\ \ \ \ \ frame-\/>\mbox{\hyperlink{structmessage__frame__t_a5e0eac93675392e0ae2ab36d85449caf}{mode}}\ =\ (\mbox{\hyperlink{message_8h_a764b90a6667d70cc8ac65054ade8604f}{message\_mode\_t}})((canId\ >>\ 9)\ \&\ 0x01);}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00051}00051\ \ \ \ \ frame-\/>\mbox{\hyperlink{structmessage__frame__t_adfd13b91d35801a9f13c730d0ab9d3b5}{topicOrServiceId}}\ =\ (canId\ >>\ 4)\ \&\ 0x1F;}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00052}00052\ \ \ \ \ frame-\/>\mbox{\hyperlink{structmessage__frame__t_a5f2145d3e176cdfdc684f39c7fbad8bb}{type}}\ =\ (\mbox{\hyperlink{message_8h_a78b97fef55da786a15a849fd9d7e557c}{message\_type\_t}})(canId\ \&\ 0x0F);}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00053}00053\ \}}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00054}00054\ }
\DoxyCodeLine{\Hypertarget{message_8c_source_l00061}\mbox{\hyperlink{message_8h_a2ee1650d7fa0eb6af3b0aa596b27a72d}{00061}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{message_8c_a2ee1650d7fa0eb6af3b0aa596b27a72d}{message\_serialise\_payload}}(\textcolor{keyword}{const}\ \mbox{\hyperlink{structmessage__frame__t}{message\_frame\_t}}\ *frame,\ uint8\_t\ *buffer,\ \textcolor{keywordtype}{size\_t}\ size)\ \{}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00062}00062\ \ \ \ \ \textcolor{keywordflow}{if}\ (size\ <\ 6\ +\ \mbox{\hyperlink{message_8h_a6303f7392a2d06be5a121c54278d561b}{MAX\_PAYLOAD\_SIZE}})\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00063}00063\ }
\DoxyCodeLine{\Hypertarget{message_8c_source_l00064}00064\ \ \ \ \ buffer[0]\ =\ frame-\/>\mbox{\hyperlink{structmessage__frame__t_afa4ea13cc356c637ec27480cebb341f7}{meta}}.\mbox{\hyperlink{struct_metadata__t_ad385dd55b99bba1c861f37dd9ea8c3c8}{correlationId}};}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00065}00065\ \ \ \ \ buffer[1]\ =\ frame-\/>\mbox{\hyperlink{structmessage__frame__t_afa4ea13cc356c637ec27480cebb341f7}{meta}}.\mbox{\hyperlink{struct_metadata__t_a82ca2a53aefca9af4ff51145f9691b1f}{sequenceNumber}};}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00066}00066\ \ \ \ \ buffer[2]\ =\ frame-\/>\mbox{\hyperlink{structmessage__frame__t_afa4ea13cc356c637ec27480cebb341f7}{meta}}.\mbox{\hyperlink{struct_metadata__t_a9e673429dc689fa38cb46a380f23472a}{totalFragments}};}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00067}00067\ \ \ \ \ buffer[3]\ =\ frame-\/>\mbox{\hyperlink{structmessage__frame__t_afa4ea13cc356c637ec27480cebb341f7}{meta}}.\mbox{\hyperlink{struct_metadata__t_a4584a7b93363d9524705470e69d743de}{responseCode}};}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00068}00068\ }
\DoxyCodeLine{\Hypertarget{message_8c_source_l00069}00069\ }
\DoxyCodeLine{\Hypertarget{message_8c_source_l00070}00070\ \ \ \ \ memcpy(buffer\ +\ 4,\ frame-\/>\mbox{\hyperlink{structmessage__frame__t_a1677d80e48189228cc0c188e9f78e57e}{payload}},\ \mbox{\hyperlink{message_8h_a6303f7392a2d06be5a121c54278d561b}{MAX\_PAYLOAD\_SIZE}});}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00071}00071\ \}}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00072}00072\ }
\DoxyCodeLine{\Hypertarget{message_8c_source_l00079}\mbox{\hyperlink{message_8h_a024ea87d32238f9e5e22ce9e17c0ea13}{00079}}\ \textcolor{keywordtype}{void}\ \mbox{\hyperlink{message_8c_a024ea87d32238f9e5e22ce9e17c0ea13}{message\_deserialise\_payload}}(\textcolor{keyword}{const}\ uint8\_t\ *buffer,\ \textcolor{keywordtype}{size\_t}\ size,\ \mbox{\hyperlink{structmessage__frame__t}{message\_frame\_t}}\ *frame)\ \{}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00080}00080\ \ \ \ \ \textcolor{keywordflow}{if}\ (size\ <\ 4)\ \textcolor{keywordflow}{return};}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00081}00081\ }
\DoxyCodeLine{\Hypertarget{message_8c_source_l00082}00082\ \ \ \ \ frame-\/>\mbox{\hyperlink{structmessage__frame__t_afa4ea13cc356c637ec27480cebb341f7}{meta}}.\mbox{\hyperlink{struct_metadata__t_ad385dd55b99bba1c861f37dd9ea8c3c8}{correlationId}}\ =\ buffer[0];}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00083}00083\ \ \ \ \ frame-\/>\mbox{\hyperlink{structmessage__frame__t_afa4ea13cc356c637ec27480cebb341f7}{meta}}.\mbox{\hyperlink{struct_metadata__t_a82ca2a53aefca9af4ff51145f9691b1f}{sequenceNumber}}\ =\ buffer[1];}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00084}00084\ \ \ \ \ frame-\/>\mbox{\hyperlink{structmessage__frame__t_afa4ea13cc356c637ec27480cebb341f7}{meta}}.\mbox{\hyperlink{struct_metadata__t_a9e673429dc689fa38cb46a380f23472a}{totalFragments}}\ =\ buffer[2];}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00085}00085\ \ \ \ \ frame-\/>\mbox{\hyperlink{structmessage__frame__t_afa4ea13cc356c637ec27480cebb341f7}{meta}}.\mbox{\hyperlink{struct_metadata__t_a4584a7b93363d9524705470e69d743de}{responseCode}}\ =\ buffer[3];}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00086}00086\ }
\DoxyCodeLine{\Hypertarget{message_8c_source_l00087}00087\ \ \ \ \ memcpy(frame-\/>\mbox{\hyperlink{structmessage__frame__t_a1677d80e48189228cc0c188e9f78e57e}{payload}},\ buffer\ +\ 4,\ \mbox{\hyperlink{message_8h_a6303f7392a2d06be5a121c54278d561b}{MAX\_PAYLOAD\_SIZE}});}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00088}00088\ \}}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00089}00089\ }
\DoxyCodeLine{\Hypertarget{message_8c_source_l00090}00090\ \textcolor{preprocessor}{\#ifdef\ \_\_cplusplus}}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00091}00091\ \}}
\DoxyCodeLine{\Hypertarget{message_8c_source_l00092}00092\ \textcolor{preprocessor}{\#endif}}

\end{DoxyCode}
